@using Main.Presentation.MVC.Controllers
@model HomeViewModel
@using Main.Presentation.MVC.ViewModel
@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<SharedResource> Localizer
@{
    ViewData["Title"] = @Localizer["My Inventories"];
}

<div class="container-fluid">
    <div class="col">
        <h1 class="display-6">@Localizer["Inventories"]</h1>
        <p class="text-muted">@Localizer["Manage your personal inventories and shared access"]</p>
    </div>

    <ul class="nav nav-tabs mb-4" id="inventoryTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="my-inventories-tab" data-bs-toggle="tab"
                    data-bs-target="#my-inventories" type="button" role="tab"
                    aria-controls="my-inventories" aria-selected="true">
                <i class="fas fa-user me-2"></i>@Localizer["My Inventories"]
                <span class="badge bg-primary ms-2">@Model.UserInventories.Count</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="shared-inventories-tab" data-bs-toggle="tab"
                    data-bs-target="#shared-inventories" type="button" role="tab"
                    aria-controls="shared-inventories" aria-selected="false">
                <i class="fas fa-users me-2"></i>@Localizer["Shared With Me"]
                <span class="badge bg-success ms-2">@Model.SharedInventories.Count</span>
            </button>
        </li>
    </ul>

    <div class="tab-content" id="inventoryTabsContent">
        <div class="tab-pane fade show active" id="my-inventories" role="tabpanel" aria-labelledby="my-inventories-tab">
            <div class="row mb-4">

                <div class="col-auto">
                    <div class="d-flex gap-2">
                        <a href="@Url.Action("Create", "Inventories")" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>@Localizer["Create New"] @Localizer["Inventory"]
                        </a>
                            <button type="submit" id="deleteSelected" class="btn btn-danger">
                                <i class="fas fa-trash me-2"></i>@Localizer["Delete Selected"]
                            </button>
                    </div>
                </div>
            </div>
            <partial name="~/Views/Inventories/Components/_InventoryTable.cshtml" model="Model.UserInventories" view-data="@(new ViewDataDictionary(ViewData) { { "TableType", "myInventoriesTable" } })" />
        </div>

        <div class="tab-pane fade" id="shared-inventories" role="tabpanel" aria-labelledby="shared-inventories-tab">
            <partial name="~/Views/Inventories/Components/_InventoryTable.cshtml" model="Model.SharedInventories" view-data="@(new ViewDataDictionary(ViewData) { { "TableType", "sharedInventoriesTable" } })" />
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/inventory-selection.js" asp-append-version="true"></script>
   @*  <script>
        document.addEventListener('DOMContentLoaded', function() {
            const activeTab = localStorage.getItem('activeInventoryTab') || 'my-inventories-tab';
            const tab = new bootstrap.Tab(document.getElementById(activeTab));
            tab.show();

            document.querySelectorAll('#inventoryTabs button').forEach(tabEl => {
                tabEl.addEventListener('shown.bs.tab', function (event) {
                    localStorage.setItem('activeInventoryTab', event.target.id);
                });
            });

            initializeDataTables();
        });
    </script> *@
}

